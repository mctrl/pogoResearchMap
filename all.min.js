var request,gmarkers=[];function Pushbullet(){PushBullet.o="o.HvSM73Nce2NTazVaVFVTMHcakiBDnZQ1";PushBullet.s().s[0].t;var e=document.getElementById("Research Task");PushBullet.push("note",null,null,{title:"New Research Task",body:e.value})}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(e){var o;for(i=0;i<gmarkers.length;i++)gmarkers[i].l(null);var t=document.getElementById("location"),a=new google.u.i(e.coords.latitude,e.coords.longitude);t.value=e.coords.latitude+","+e.coords.longitude,o=new google.u.m({position:a,map:map,draggable:!0,animation:google.u.p.g,title:"Your location",icon:"icons/darkgreen_MarkerA.png"}),map.h(a),map.k(17),gmarkers.push(o),google.u.event.addListener(o,"dragend",function(e){t.value=e.v.T().toFixed(5)+","+e.v.R().toFixed(5)}),google.u.event.addListener(o,"dragstart",function(e){t.value="Currently dragging marker"})}$(".hideshow").q("click",function(){$(".TaskSubmitter").stop(!0,!0).C().A("opened"),!0===$(".TaskSubmitter").is(".opened")&&getLocation()}),$("#foo").submit(function(e){if(e.preventDefault(),"All"==document.getElementById("Research Task").value)$.N("Please Choose a Task from the List",{position:"right middle",style:"bootstrap",className:"error"});else{var o=document.getElementById("Research Task");document.getElementById("Reward").value=o.options[o.selectedIndex].dataset.L,request&&request.abort();var t=$(this),a=t.find("Research Task,Reward, location"),s=t.P();a.S("disabled",!0),request=$.$({url:"https://script.google.com/macros/s/AKfycbww5kraaGA3JNaMvl0TqWUiJRm4NcquT_E_Sy8zifxjbMTXjkPq/exec",type:"post",data:s}),$.N("Posting Task please wait...",{position:"right middle",style:"bootstrap",className:"success",M:1500}),request.done(function(e,o,t){$.N("Research Task Submitted for Approval",{position:"right middle",style:"bootstrap",className:"success"}),Pushbullet()}),request.B(function(e,o,t){console.error("The following error occurred: "+o,t)}),request.D(function(){a.S("disabled",!1)})}});var map=null;function initialize(){var e=new google.u.i(52.92219,-1.47751),n="1_s6-uXU08BcUETuUwdg7DTBfvXc6CDHFeqNnqlXR",r="location",o=new google.u.G;map=new google.u.Map(document.getElementById("map-canvas"),{H:e,zoom:13,I:google.u.X.U,j:"greedy",V:!1,_:!1,F:!1,J:!1});var l=new google.u.O({W:{select:r,from:n},map:map,Y:2,Z:2}),t=encodeURIComponent("SELECT 'Task Name', 'Reward' FROM 1mlP-EhLtoaiGR24ChXSgdYbO2h7ZapUjMADXmcPc"),a=["https://www.googleapis.com/fusiontables/v1/query"];a.push("?sql="+t),a.push("&key=AIzaSyAm9yWCV7JPCTHCJut8whOjARd7pwROFDQ"),a.push("&callback=?");var i=document.createElement("select"),c=document.getElementById("Research Task");i.style="display:block; margin:auto; width:100%",i.id="taskList";var s=document.createElement("option"),u=document.createElement("option");s.innerHTML="All Tasks",s.value="All",u.innerHTML="None Selected",u.value="All",i.appendChild(s),c.appendChild(u),$.$({url:a.join(""),K:"jsonp",ee:function(e){var o=e.rows,t=document.getElementById("ft-data");for(var a in o){var s=o[a][0],n=o[a][1],r=document.createElement("option"),l=document.createElement("option");r.innerHTML=s,r.value=s,r.setAttribute("data-reward",n),l.innerHTML=s,l.value=s,l.setAttribute("data-reward",n),i.appendChild(r),t.appendChild(i),c.appendChild(l)}}});var d=function(){var e=document.getElementById("address").value;o.oe({te:e},function(e,o){if(o==google.u.se.ae){map.h(e[0].ne.location),map.k(10);var t=map.le().re(),a=map.le().ie(),s="ST_INTERSECTS("+r+", RECTANGLE(LATLNG"+t+", LATLNG"+a+"))";l.ce({W:{select:r,from:n,ue:s}})}else window.alert("Address could not be geocoded: "+o)})};google.u.event.de(document.getElementById("search"),"click",d),google.u.event.de(window,"keypress",function(e){13==e.keyCode&&d()}),google.u.event.de(document.getElementById("reset"),"click",function(){map.h(e),map.k(13),l.ce({W:{select:r,from:n}})}),setTimeout(function(){google.u.event.de(document.getElementById("taskList"),"change",function(){var e,o,t,a;e=l,o=n,t=r,a=document.getElementById("taskList").value,console.log(t),console.log(a),"All"!=a?e.ce({W:{select:t,from:o,ue:"'Research Task'='"+a+"'"}}):e.ce({W:{select:t,from:o}})})},2e3)}google.u.event.de(window,"load",initialize);